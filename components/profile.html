<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω t√†i kho·∫£n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f0f0f;
            color: white;
            padding: 30px;
        }

        .profile-box {
            max-width: 450px;
            margin: auto;
            background: #1c1c1c;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        }

        textarea {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border-radius: 10px;
            border: none;
            outline: none;
            background: #2b2b2b;
            color: white;
            font-size: 14px;
            resize: none;
        }

        .back-btn {
            color: #00b4ff;
            margin-bottom: 15px;
            display: inline-block;
            cursor: pointer;
            font-size: 14px;
        }

        .avatar-wrapper {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-wrapper img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #00b4ff;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border-radius: 10px;
            border: none;
            outline: none;
            background: #2b2b2b;
            color: white;
            font-size: 14px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-size: 14px;
            opacity: .9;
        }

        .password-box {
            position: relative;
        }

        .eye-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 16px;
            color: #aaa;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-top: 25px;
            border-radius: 12px;
            border: none;
            background: #00b4ff;
            color: white;
            font-size: 15px;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }
    </style>
</head>

<body>

    <div class="profile-box">

        <div class="back-btn" onclick="history.back()">‚Üê Quay l·∫°i</div>

        <div class="avatar-wrapper">
            <img id="avatarPreview" src="">
            <input type="text" id="avatarInput" placeholder="D√°n link ·∫£nh avatar m·ªõi..." />
        </div>
        <div class="form-group mb-4">
            <label for="bioInput" class="form-label">Ti·ªÉu s·ª≠</label>
            <textarea class="form-control" id="bioInput" rows="3"
                placeholder="Chia s·∫ª m·ªôt ch√∫t v·ªÅ b·∫£n th√¢n b·∫°n..."></textarea>
        </div>
        <label>H·ªç v√† t√™n</label>
        <input type="text" id="fullnameInput" />

        <label>Email</label>
        <input type="email" id="emailInput" />

        <label>M·∫≠t kh·∫©u</label>
        <div class="password-box">
            <input type="password" id="passwordInput" />
            <span class="eye-btn" id="togglePassword">üëÅ</span>
        </div>

        <label>Ng√†y sinh</label>
        <input type="date" id="dobInput" />

        <button id="saveBtn">L∆∞u thay ƒë·ªïi</button>

    </div>

    <script>
        const USER_KEY = "vitaflix_current_user";
        const MASTER_USERS_KEY = "vitaflix_users";
        let user = JSON.parse(localStorage.getItem(USER_KEY));

        // N·∫øu ch∆∞a login
        if (!user) {
            window.location.href = "/auth/login.html";
        }

        // Kh·ªüi t·∫°o m·∫∑c ƒë·ªãnh n·∫øu thi·∫øu field
        user.fullname = user.fullname || user.firstName + " " + user.lastName || "";
        user.avatar = user.avatar || "https://via.placeholder.com/150";
        user.dob = user.dob || "";

        // Render d·ªØ li·ªáu
        document.getElementById("avatarPreview").src = user.avatar;
        document.getElementById("fullnameInput").value = user.fullname;
        document.getElementById("emailInput").value = user.email;
        document.getElementById("passwordInput").value = user.password;
        document.getElementById("dobInput").value = user.dob;
        document.getElementById("bioInput").value = user.bio || '';

        // Toggle m·∫≠t kh·∫©u
        document.getElementById("togglePassword").addEventListener("click", () => {
            const passInput = document.getElementById("passwordInput");
            passInput.type = passInput.type === "password" ? "text" : "password";
        });

        // C·∫≠p nh·∫≠t avatar realtime khi nh·∫≠p link
        document.getElementById("avatarInput").addEventListener("input", (e) => {
            const url = e.target.value.trim();
            if (url) {
                document.getElementById("avatarPreview").src = url;
            }
        });

        // L∆∞u d·ªØ li·ªáu
        document.getElementById("saveBtn").addEventListener("click", () => {
            user.fullname = document.getElementById("fullnameInput").value.trim();
            user.email = document.getElementById("emailInput").value.trim();
            user.password = document.getElementById("passwordInput").value;
            user.dob = document.getElementById("dobInput").value;
            user.bio = document.getElementById("bioInput").value.trim(); // <-- L∆ØU BIO

            const newAvatar = document.getElementById("avatarInput").value.trim();
            if (newAvatar) {
                user.avatar = newAvatar;
            }

            
            localStorage.setItem(USER_KEY, JSON.stringify(user));

           
            let users = JSON.parse(localStorage.getItem(MASTER_USERS_KEY) || '[]');

           
            const userIndex = users.findIndex(u => u.email === user.email);

            if (userIndex !== -1) {
             
                users[userIndex].fullname = user.fullname;
                users[userIndex].email = user.email;
                users[userIndex].password = user.password;
                users[userIndex].dob = user.dob;
                users[userIndex].avatar = user.avatar;
                users[userIndex].bio = user.bio; 

                localStorage.setItem(MASTER_USERS_KEY, JSON.stringify(users));

            } else {
               
                console.warn("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng trong danh s√°ch Master List!");
            }
           

            alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");

            window.dispatchEvent(new Event('storage'));
        });


    </script>

</body>

</html>